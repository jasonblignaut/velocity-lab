<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Velocity Lab</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header Navigation -->
    <header class="header">
        <nav class="nav">
            <div class="nav-brand">
                <h1>üöÄ Velocity Lab</h1>
                <span class="nav-subtitle">Profile Settings</span>
            </div>
            <div class="nav-user">
                <span id="userInfo" class="user-info">Loading...</span>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="admin.html" id="adminLink" class="nav-link admin-link" style="display: none;">Admin</a>
                <button id="logout" class="btn btn-outline">Logout</button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main profile-main">
        <div class="profile-container">
            <!-- Profile Header -->
            <section class="profile-header">
                <div class="profile-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-initials" id="avatarInitials">?</span>
                    </div>
                    <button class="avatar-upload" aria-label="Upload profile picture">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                    </button>
                </div>
                <div class="profile-info">
                    <h2 id="profileName">Loading...</h2>
                    <p id="profileEmail">Loading...</p>
                    <p id="profileCompany" class="profile-company">Loading...</p>
                </div>
            </section>

            <!-- Profile Navigation -->
            <nav class="profile-nav" role="tablist">
                <button class="profile-nav-item active" data-tab="overview" role="tab" aria-selected="true">
                    üìä Overview
                </button>
                <button class="profile-nav-item" data-tab="settings" role="tab" aria-selected="false">
                    ‚öôÔ∏è Settings
                </button>
                <button class="profile-nav-item" data-tab="security" role="tab" aria-selected="false">
                    üîí Security
                </button>
                <button class="profile-nav-item" data-tab="history" role="tab" aria-selected="false">
                    üìö Lab History
                </button>
            </nav>

            <!-- Profile Content -->
            <div class="profile-content">
                <!-- Overview Tab -->
                <section id="overview" class="profile-tab active" role="tabpanel">
                    <h3>Training Overview</h3>
                    
                    <!-- Current Progress -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-content">
                                <h4>Overall Progress</h4>
                                <div class="stat-value" id="overallProgress">0%</div>
                                <div class="stat-detail" id="taskProgress">0/42 tasks completed</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-content">
                                <h4>Current Week</h4>
                                <div class="stat-value" id="currentWeek">Week 1</div>
                                <div class="stat-detail" id="weekProgress">Foundation Setup</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-content">
                                <h4>Time Invested</h4>
                                <div class="stat-value" id="timeInvested">0 hours</div>
                                <div class="stat-detail">Estimated completion time</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üöÄ</div>
                            <div class="stat-content">
                                <h4>Labs Started</h4>
                                <div class="stat-value" id="labsStarted">1</div>
                                <div class="stat-detail">Training sessions</div>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Progress -->
                    <div class="weekly-progress">
                        <h4>Weekly Progress Breakdown</h4>
                        <div class="week-progress-grid">
                            <div class="week-progress-item" data-week="week1">
                                <div class="week-progress-header">
                                    <h5>üìö Week 1: Foundation Setup</h5>
                                    <span class="week-progress-count">0/12</span>
                                </div>
                                <div class="progress-bar-small">
                                    <div class="progress-fill-small" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="week-progress-item" data-week="week2">
                                <div class="week-progress-header">
                                    <h5>üèóÔ∏è Week 2: Infrastructure Expansion</h5>
                                    <span class="week-progress-count">0/8</span>
                                </div>
                                <div class="progress-bar-small">
                                    <div class="progress-fill-small" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="week-progress-item" data-week="week3">
                                <div class="week-progress-header">
                                    <h5>üìß Week 3: Email & Messaging</h5>
                                    <span class="week-progress-count">0/12</span>
                                </div>
                                <div class="progress-bar-small">
                                    <div class="progress-fill-small" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="week-progress-item" data-week="week4">
                                <div class="week-progress-header">
                                    <h5>‚òÅÔ∏è Week 4: Cloud Integration</h5>
                                    <span class="week-progress-count">0/10</span>
                                </div>
                                <div class="progress-bar-small">
                                    <div class="progress-fill-small" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h4>Quick Actions</h4>
                        <div class="action-buttons">
                            <a href="dashboard.html" class="btn btn-primary">
                                üìö Continue Training
                            </a>
                            <button id="exportDataBtn" class="btn btn-outline">
                                üì• Export Progress
                            </button>
                            <button id="resetProgressBtn" class="btn btn-outline btn-warning">
                                üîÑ Start New Lab
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Settings Tab -->
                <section id="settings" class="profile-tab" role="tabpanel" hidden>
                    <h3>Account Settings</h3>
                    
                    <form id="profileForm" class="settings-form">
                        <input type="hidden" id="csrfToken" name="csrf_token" value="">
                        
                        <div class="form-group">
                            <label for="settingsName" class="form-label">Full Name</label>
                            <input 
                                type="text" 
                                id="settingsName" 
                                name="name" 
                                class="form-input" 
                                placeholder="Enter your full name"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="settingsEmail" class="form-label">Email Address</label>
                            <input 
                                type="email" 
                                id="settingsEmail" 
                                name="email" 
                                class="form-input" 
                                placeholder="Enter your email"
                                required
                                readonly
                            >
                            <div class="field-help">Contact admin to change email address</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="settingsCompany" class="form-label">Company</label>
                            <input 
                                type="text" 
                                id="settingsCompany" 
                                name="company" 
                                class="form-input" 
                                placeholder="Enter your company name"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="settingsTimezone" class="form-label">Timezone</label>
                            <select id="settingsTimezone" name="timezone" class="form-select">
                                <option value="UTC">UTC (Coordinated Universal Time)</option>
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Chicago">Central Time (CT)</option>
                                <option value="America/Denver">Mountain Time (MT)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                <option value="Europe/London">London (GMT/BST)</option>
                                <option value="Europe/Paris">Paris (CET/CEST)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                            </select>
                        </div>

                        <!-- Notification Preferences -->
                        <div class="form-section">
                            <h4>Notification Preferences</h4>
                            
                            <label class="checkbox-wrapper">
                                <input type="checkbox" name="emailNotifications" class="checkbox-input" checked>
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Email notifications for important updates</span>
                            </label>
                            
                            <label class="checkbox-wrapper">
                                <input type="checkbox" name="progressReminders" class="checkbox-input" checked>
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Weekly progress reminders</span>
                            </label>
                            
                            <label class="checkbox-wrapper">
                                <input type="checkbox" name="newFeatures" class="checkbox-input">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Notifications about new features and content</span>
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                üíæ Save Changes
                            </button>
                            <button type="button" class="btn btn-outline" id="cancelSettings">
                                Cancel
                            </button>
                        </div>
                    </form>
                </section>

                <!-- Security Tab -->
                <section id="security" class="profile-tab" role="tabpanel" hidden>
                    <h3>Security Settings</h3>
                    
                    <!-- Change Password -->
                    <div class="security-section">
                        <h4>Change Password</h4>
                        <p class="section-description">Ensure your account is secure with a strong password</p>
                        
                        <form id="passwordForm" class="security-form">
                            <input type="hidden" id="csrfTokenPassword" name="csrf_token" value="">
                            
                            <div class="form-group">
                                <label for="currentPassword" class="form-label">Current Password</label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        id="currentPassword" 
                                        name="currentPassword" 
                                        class="form-input" 
                                        placeholder="Enter current password"
                                        required
                                        autocomplete="current-password"
                                    >
                                    <button type="button" class="toggle-password" aria-label="Toggle password visibility">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword" class="form-label">New Password</label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        id="newPassword" 
                                        name="newPassword" 
                                        class="form-input" 
                                        placeholder="Enter new password"
                                        required
                                        autocomplete="new-password"
                                        minlength="8"
                                    >
                                    <button type="button" class="toggle-password" aria-label="Toggle password visibility">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                                <div class="field-help">Password must be at least 8 characters long</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                <div class="input-wrapper">
                                    <input 
                                        type="password" 
                                        id="confirmNewPassword" 
                                        name="confirmNewPassword" 
                                        class="form-input" 
                                        placeholder="Confirm new password"
                                        required
                                        autocomplete="new-password"
                                        minlength="8"
                                    >
                                    <button type="button" class="toggle-password" aria-label="Toggle password visibility">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    üîí Update Password
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Account Security -->
                    <div class="security-section">
                        <h4>Account Security</h4>
                        <div class="security-info">
                            <div class="security-item">
                                <div class="security-icon">üõ°Ô∏è</div>
                                <div class="security-content">
                                    <h5>Last Password Change</h5>
                                    <p id="lastPasswordChange">Never</p>
                                </div>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-icon">üåê</div>
                                <div class="security-content">
                                    <h5>Last Login</h5>
                                    <p id="lastLogin">Loading...</p>
                                </div>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-icon">üì±</div>
                                <div class="security-content">
                                    <h5>Active Sessions</h5>
                                    <p>1 active session</p>
                                    <button class="btn btn-outline btn-sm">Manage Sessions</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="security-section danger-zone">
                        <h4>Danger Zone</h4>
                        <p class="section-description">These actions cannot be undone</p>
                        
                        <div class="danger-actions">
                            <button class="btn btn-danger" id="deleteAccountBtn">
                                üóëÔ∏è Delete Account
                            </button>
                            <p class="danger-text">Permanently delete your account and all training data</p>
                        </div>
                    </div>
                </section>

                <!-- Lab History Tab -->
                <section id="history" class="profile-tab" role="tabpanel" hidden>
                    <h3>Lab History</h3>
                    <p class="section-description">View your past training sessions and progress</p>
                    
                    <div class="history-controls">
                        <button id="exportHistoryBtn" class="btn btn-outline">
                            üìä Export History
                        </button>
                    </div>
                    
                    <div id="labHistoryContainer" class="lab-history">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading lab history...</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Notification System -->
    <div id="notification" class="notification" role="alert" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Profile-specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize profile tabs
            initProfileTabs();
            
            // Load user profile data
            loadProfileData();
            
            // Load lab history
            loadLabHistory();
            
            // Set up profile form handlers
            setupProfileForms();
        });

        function initProfileTabs() {
            const navItems = document.querySelectorAll('.profile-nav-item');
            const tabPanels = document.querySelectorAll('.profile-tab');
            
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    const targetTab = e.target.dataset.tab;
                    
                    // Update nav items
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        nav.setAttribute('aria-selected', 'false');
                    });
                    e.target.classList.add('active');
                    e.target.setAttribute('aria-selected', 'true');
                    
                    // Update tab panels
                    tabPanels.forEach(panel => {
                        panel.classList.remove('active');
                        panel.hidden = true;
                    });
                    const targetPanel = document.getElementById(targetTab);
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                        targetPanel.hidden = false;
                    }
                });
            });
        }

        function loadProfileData() {
            // Load user info from cookie or API
            const user = JSON.parse(getCookie('user') || '{}');
            
            if (user.name) {
                document.getElementById('profileName').textContent = user.name;
                document.getElementById('settingsName').value = user.name;
                
                // Set avatar initials
                const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                document.getElementById('avatarInitials').textContent = initials;
            }
            
            if (user.email) {
                document.getElementById('profileEmail').textContent = user.email;
                document.getElementById('settingsEmail').value = user.email;
            }
            
            if (user.company) {
                document.getElementById('profileCompany').textContent = user.company;
                document.getElementById('settingsCompany').value = user.company;
            } else {
                document.getElementById('profileCompany').style.display = 'none';
            }
        }

        function setupProfileForms() {
            // Profile settings form
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    // Handle profile update
                    showNotification('Profile updated successfully!', 'success');
                });
            }
            
            // Export data button
            const exportBtn = document.getElementById('exportDataBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    exportUserData();
                });
            }
            
            // Reset progress button
            const resetBtn = document.getElementById('resetProgressBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    startNewLab();
                });
            }
        }
    </script>
</body>
</html>